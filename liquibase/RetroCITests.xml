<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
	
	<changeSet author="nixonl" id="7" context="CDIRetroCI" runOnChange="true">
		<preConditions onFail="MARK_RAN">
 			 <sqlCheck expectedResult="0">
 				select count(*) from dictionary_category where local_abbrev = 'PsNgIndInv'
 			</sqlCheck> 
   		</preConditions>
  		<comment>Add Result Values to Dictionary table</comment>
  		<insert schemaName="clinlims" tableName="dictionary_category">
                     <column name="id" valueNumeric=" nextval( 'dictionary_category_seq' ) "/>  
                     <column name="name" value="PosNegIndInv"/>
                     <column name="description" value="Result Values - Pos, Neg, Indeterminate, Invalid"/>
                     <column name="local_abbrev" value="PsNgIndInv"/>         
                       <column name="lastupdated" valueDate='now()' />   
       	</insert>
  		<insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>      
                     <column name="dict_entry" value="Positive"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.PosNegIndInv.positive"/>
        </insert>
  		<insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>                    
                     <column name="dict_entry" value="Negative"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                     <column name="lastupdated" valueDate= 'now()' />
                      <column name="display_key" value="dict.PosNegIndInv.negative"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>                    
                     <column name="dict_entry" value="Indeterminate"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.PosNegIndInv.indeterminate"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>                    
                     <column name="dict_entry" value="Invalid"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.PosNegIndInv.invalid"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary_category">
                     <column name="id" valueNumeric=" nextval( 'dictionary_category_seq' ) "/>  
                     <column name="name" value="HIVResult"/>
                     <column name="description" value="HIV Result-HIV1, HIV2, HIVD, Neg, Indtrminate, Invalid"/>
                     <column name="local_abbrev" value="HIVResult"/>         
                       <column name="lastupdated" valueDate='now()' />   
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>      
                     <column name="dict_entry" value="HIV1"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.HIVResult.hiv1"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>      
                     <column name="dict_entry" value="HIV2"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.HIVResult.hiv2"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>      
                     <column name="dict_entry" value="HIVD"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.HIVResult.hivd"/>
        </insert>
  		<insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>                    
                     <column name="dict_entry" value="Negative"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                     <column name="lastupdated" valueNumeric=" now() "/>
                      <column name="display_key" value="dict.HIVResult.negative"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>                    
                     <column name="dict_entry" value="Indeterminate"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.HIVResult.indeterminate"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
                     <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                     <column name="is_active" value="Y"/>                    
                     <column name="dict_entry" value="Invalid"/>
                     <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                      <column name="lastupdated" valueDate='now()' /> 
                      <column name="display_key" value="dict.HIVResult.invalid"/>
        </insert>
        
  	</changeSet>
	
	
	<changeSet author="nixonl" id="8" context="CDIRetroCI" runOnChange="true">
           	<preConditions onFail="MARK_RAN">
  			 <sqlCheck expectedResult="0">
  				select count(*) from type_of_sample where description = 'Dry Tube'
  			</sqlCheck> 
    		</preConditions>
			<comment>Inserting type_of_sample, test_sections and tests </comment>
			<delete schemaName="clinlims" tableName="sampletype_test"/>
			<delete schemaName="clinlims" tableName="sampletype_panel"/>
   			<delete schemaName="clinlims" tableName="result_limits"/>  
   			<delete schemaName="clinlims" tableName="test_analyte"/> 
   			<delete schemaName="clinlims" tableName="test_result"/> 
   			<delete schemaName="clinlims" tableName="test"/> 
   			<delete schemaName="clinlims" tableName="type_of_sample"/>
   			<delete schemaName="clinlims" tableName="test_section"/> 
   			
            <!-- DRY TUBE -->
            <insert schemaName="clinlims" tableName="type_of_sample">
                    <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>    
                    <column name="lastupdated" valueDate='now()' />
			   		<column name="domain" value='H'/>
			   		<column name="description" value="Dry Tube"/> 
			   		<column name="local_abbrev" value="Dry"/> 
                    <column name="display_key" value="sample.type.dryTube"/>         
            </insert>
    
			            <!--  Biochemistry Department-->
			            <insert schemaName="clinlims" tableName="test_section">
			                    <column name="id" valueNumeric=" nextval( 'test_section_seq' ) "/>   
			                    <column name="org_id" valueNumeric=" ( select id from clinlims.organization where name='Retro-CI' ) "/>  
			                    <column name="lastupdated" valueDate='now()' />
						   		<column name="name" value="Biochemistry"/>
						   		<column name="description" value="Biochemistry Department"/> 
			                    <column name="is_external" value='N' />         
			            </insert>
			            
			            <!-- Glycemie Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Glycémie"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/> 
			                    <column name="local_abbrev" value='Glycémie' />
			                    <column name="display_key" value="test.glycemie"/>
			            </insert> 
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   		<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   		<column name="is_panel" value="False"/>           
			            </insert>  
			             <!-- Creatininemie Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Créatininémie"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Créatininémie' />
			                    <column name="display_key" value="test.creatininemie"/>
			            </insert>  
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			      
			      		<!--  Transaminiases Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Transaminiases"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Transaminiases' />
			                    <column name="display_key" value="test.transaminiases"/>
			            </insert>  
			            <insert schemaName="clinlims" tableName="sampletype_test">
				              	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							  	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            
			            <!--  Serology Department-->
			            <insert schemaName="clinlims" tableName="test_section">
			                    <column name="id" valueNumeric=" nextval( 'test_section_seq' ) "/>    
			                      <column name="org_id" valueNumeric=" ( select id from clinlims.organization where name='Retro-CI' ) "/>  
			                    <column name="lastupdated" valueDate='now()' />
						   		<column name="name" value="Serology"/>
						  		<column name="description" value="Serology Department"/> 
			                    <column name="is_external" value='N' />         
			            </insert>
			            
			           
			            <!--  Serology HIV Test -->
			            <!-- May use later
			            
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Serology HIV"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Serology HIV' />
			                    <column name="display_key" value="test.serologyHIV"/>
			            </insert> 
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>   
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Positive' ) "/>
			            		<column name="result_group" valueNumeric="10"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Negative' ) "/>
			            		<column name="result_group" valueNumeric="10"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="10"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where dict_entry='Invalid' ) "/>
			            		<column name="result_group" valueNumeric="10"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			             -->
			             
			            <!--  p24 Ag Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="p24 Ag"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='p24 Ag' />
			                    <column name="display_key" value="test.p24Ag"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
			            		<column name="result_group" valueNumeric="9"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
			            		<column name="result_group" valueNumeric="9"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeteriminate' ) "/>
			            		<column name="result_group" valueNumeric="9"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
			            		<column name="result_group" valueNumeric="9"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			             <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="p24 Ag Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="9"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            
			            <!--  Western Blot 2 Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Western Blot 2"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Western Blot 2' />
			                    <column name="display_key" value="test.westernBlot2"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Western Blot 2 Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="8"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
			            		<column name="result_group" valueNumeric="8"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
			            		<column name="result_group" valueNumeric="8"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            <!-- Western Blot 2 Reflex Test -->
			            <!--  If Negative -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>	
			            		<column name="lastupdated" valueDate='now()' /> 
				        </insert> 
				        
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="8"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            <!-- Western Blot 2 Reflex Test -->
			            <!--  If Indeterminate -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>	
			            		<column name="lastupdated" valueDate='now()' /> 
				        </insert>
			            
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
			            		<column name="result_group" valueNumeric="8"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
		            
			            <!--  Western Blot I Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Western Blot 1"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Western Blot 1' />
			                    <column name="display_key" value="test.westernBlot1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Western Blot 1 Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="7"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
			            		<column name="result_group" valueNumeric="7"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
			            		<column name="result_group" valueNumeric="7"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            <!-- Western Blot 1 Reflex Test -->
			            <!--  If Negative -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>	
			            		<column name="lastupdated" valueDate='now()' /> 
				        </insert> 
				        
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="7"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            <!-- Western Blot 1 Reflex Test -->
			            <!--  If Indeterminate -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>	
			            		<column name="lastupdated" valueDate='now()' /> 
				        </insert>        
        
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
			            		<column name="result_group" valueNumeric="7"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            
			               <!--  Genie II 10 -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Genie II 10"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Genie II 10' />
			                    <column name="display_key" value="test.genieII10"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
						<insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hiv1' ) "/>
			            		<column name="result_group" valueNumeric="6"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hiv2' ) "/>
			            		<column name="result_group" valueNumeric="6"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hivd' ) "/>
			            		<column name="result_group" valueNumeric="6"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.negative' ) "/>
			            		<column name="result_group" valueNumeric="6"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>           
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="6"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>   
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.invalid' ) "/>
			            		<column name="result_group" valueNumeric="6"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Genie II 10 Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="6"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            
			            <!--  Genie II 100 Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Genie II 100"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Genie II 100' />
			                    <column name="display_key" value="test.genieII100"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Genie II 100 Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="5"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>  
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hiv1' ) "/>
			            		<column name="result_group" valueNumeric="5"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hiv2' ) "/>
			            		<column name="result_group" valueNumeric="5"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hivd' ) "/>
			            		<column name="result_group" valueNumeric="5"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.negative' ) "/>
			            		<column name="result_group" valueNumeric="5"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <!-- Genie II 100 Reflex Test -->
			            <!--  If Negative -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
			            		
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Genie II 10' ) "/>
			            		<!--  No sibling -->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="5"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.invalid' ) "/>
			            		<column name="result_group" valueNumeric="5"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            
			             <!--  Genie II Test -->
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Genie II"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Genie II' />
			                    <column name="display_key" value="test.genieII"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Genie II Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="4"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hivd' ) "/>
			            		<column name="result_group" valueNumeric="4"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <!-- Genie II Reflex Test -->
			            <!--  If HIVD -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
			            		
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Genie II 100' ) "/>
			            		<!--  No sibling id-->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
			            
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.negative' ) "/>
			            		<column name="result_group" valueNumeric="4"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <!-- Genie II Reflex Test -->
			            <!--  If Negative -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
			            		
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
			            		<!--  No sibling -->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
				         <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
			            		
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
			            		<!--  No sibling -->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="4"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.invalid' ) "/>
			            		<column name="result_group" valueNumeric="4"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            
			            
			            <!--  Vironostika Test -->            
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Vironostika"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Vironostika' />
			                    <column name="display_key" value="test.vironostika"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Vironostika Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="3"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
			            		<column name="result_group" valueNumeric="3"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <!-- Vironostika Reflex Tests -->
			            <!--  If Positive -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
			            		
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Genie II' ) "/>
			            		<!--  No sibling -->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
			            
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
			            		<column name="result_group" valueNumeric="3"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="3"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
			            		<column name="result_group" valueNumeric="3"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			             
			            <!--  Murex Test --> 
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Murex"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Murex' />
			                    <column name="display_key" value="test.murex"/>
			            </insert> 
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Murex Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="2"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
			            		<column name="result_group" valueNumeric="2"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            <!-- Murex Reflex Tests -->
			            <!--  If Murex is Positive and Integral is Positive -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Genie II' ) "/>
			            		<!--  Integral handles sibling id <column name="sibling_reflex" valueNumeric=""/>-->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
				         
				        <!--  If Murex is Positive and Integral is Negative -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
			            		<!--  Integral handles sibling id <column name="sibling_reflex" valueNumeric=""/>-->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert>
				        			            
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
			            		<column name="result_group" valueNumeric="2"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			             <!--  If Murex is Negative and Integral is Negative  -->
			             <!--  No reflex test -->
			             
			             <!--  If Murex is Negative and Integral is Positive -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
			            		<!--  Integral handles sibling id <column name="sibling_reflex" valueNumeric=""/>-->
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert>
				         
				         
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="2"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
			            		<column name="result_group" valueNumeric="2"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
      
			            <!--  Integral Test -->               
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Integral"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Integral' />
			                    <column name="display_key" value="test.integral"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Integral Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		            	</insert>
			            <insert schemaName="clinlims" tableName="test_analyte">
			             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
			             		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			             		<column name="analyte_id" valueNumeric=" currval( 'analyte_seq' ) "/>
			             		<column name="result_group" valueNumeric="1"/>
			             		<column name="lastupdated" valueDate='now()' /> 
			             		<column name="sort_order" valueNumeric="1"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
				             	<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
							   	<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
							   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
							   	<column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
			            		<column name="result_group" valueNumeric="1"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			            <!-- Integral Reflex Tests -->
			            <!--  If Integral is Positive and Murex is Positive -->
			         	<insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Genie II' ) "/>
			            		<column name="sibling_reflex" valueNumeric=" ( select tr.id from clinlims.test_reflex tr where test_id=( select t.id from clinlims.test t where t.local_abbrev='Murex' ) and tr.add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='Genie II') ) "/>
			            		<column name="lastupdated" valueDate='now()' /> 
				        </insert>  
				        <update schemaName="clinlims" tableName="test_reflex">
					    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
					    	<column name="lastupdated" valueDate='now()' />
					    	<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Murex') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='Genie II' ) </where>
	    				</update>
	    				
				        <!--  If Integral is Positive and Murex is Negative -->
			            <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
			            		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id=( select t.id from clinlims.test t where t.local_abbrev='Murex' ) and tr.add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='Vironostika') and tr.tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative'))) "/>
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert> 
				         <update schemaName="clinlims" tableName="test_reflex">
					    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
					    	<column name="lastupdated" valueDate='now()' />
					    	<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Murex') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='Vironostika' ) and tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative')) </where>    	
	    				</update>				        
			            
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
			            		<column name="result_group" valueNumeric="1"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            
			             <!--  If Integral is Negative and Murex is Negative -->
				         <!-- No reflex test -->
				         
				         <!--  If Integral is Negative and Murex is Positive -->
			             <insert schemaName="clinlims" tableName="test_reflex">
			            		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
			            		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>	
			            		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
			            		<column name="sibling_reflex" valueNumeric=" ( select tr.id from clinlims.test_reflex tr where tr.test_id=( select t.id from clinlims.test t where t.local_abbrev='Murex' ) and tr.add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='Vironostika') and tr.tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive'))) "/>
			            		<column name="lastupdated" valueDate='now()' /> 
				         </insert>  
				          <update schemaName="clinlims" tableName="test_reflex">
					    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
					    	<column name="lastupdated" valueDate='now()' />
					    	<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Murex') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='Vironostika' ) and tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive')) </where>    	
	    				</update>
			            
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeterminate' ) "/>
			            		<column name="result_group" valueNumeric="1"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
			            <insert schemaName="clinlims" tableName="test_result">
			            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
			            		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
			            		<column name="tst_rslt_type" value="D"/> 
			            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
			            		<column name="result_group" valueNumeric="1"/>
			            		<column name="lastupdated" valueDate='now()' /> 
			            </insert>
	
            
            <!-- EDTA TUBE -->
            <insert schemaName="clinlims" tableName="type_of_sample">
                    <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>    
                    <column name="lastupdated" valueDate='now()' />
			   		<column name="domain" value='H'/>
			   		<column name="description" value="EDTA Tube"/> 
			   		<column name="local_abbrev" value="EDTA"/> 
                    <column name="display_key" value="sample.type.edtaTube"/>         
            </insert>
			            <!--  Hematology -->
			            <insert schemaName="clinlims" tableName="test_section">
				               	<column name="id" valueNumeric=" nextval( 'test_section_seq' ) "/>   
				               	<column name="org_id" valueNumeric=" ( select id from clinlims.organization where name='Retro-CI' ) "/>   
				               	<column name="lastupdated" valueDate='now()' />
								<column name="name" value="Hematology"/>
								<column name="description" value="Hematology Department"/> 
				                <column name="is_external" value='N' />         
			            </insert>
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="NFS"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='NFS' />
			                    <column name="display_key" value="test.NFS"/>
			            </insert> 
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   		<column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   		<column name="is_panel" value="False"/>           
			            </insert>
			            <!--  Immunology -->
			            <insert schemaName="clinlims" tableName="test_section">
			                    <column name="id" valueNumeric=" nextval( 'test_section_seq' ) "/>   
			                    <column name="org_id" valueNumeric=" ( select id from clinlims.organization where name='Retro-CI' ) "/>   
			                    <column name="lastupdated" valueDate='now()' />
						   		<column name="name" value="Immunology"/>
						   		<column name="description" value="Immunology Department"/> 
			                    <column name="is_external" value='N' />         
			            </insert>
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="CD4"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='CD4' />
			                    <column name="display_key" value="test.CD4"/>
			            </insert> 
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               <column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   <column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   <column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   <column name="is_panel" value="False"/>           
			            </insert>   
			            <!--  Virology -->
			            <insert schemaName="clinlims" tableName="test_section">
			                    <column name="id" valueNumeric=" nextval( 'test_section_seq' ) "/>    
			                    <column name="org_id" valueNumeric=" ( select id from clinlims.organization where name='Retro-CI' ) "/>  
			                    <column name="lastupdated" valueDate='now()' />
						   		<column name="name" value="Virology"/>
						   		<column name="description" value="Virology Department"/> 
			                    <column name="is_external" value='N' />         
			            </insert>
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Cell Sequencing"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Cell Sequencing' />
			                    <column name="display_key" value="test.cellSequencing"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               <column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   <column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   <column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   <column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="Viral Load"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='Viral Load' />
			                    <column name="display_key" value="test.viralLoad"/>
			            </insert>
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               <column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   <column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   <column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   <column name="is_panel" value="False"/>           
			            </insert>
			            <insert schemaName="clinlims" tableName="test">
			                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
			                    <column name="description" value="DNA PCR"/> 
			                    <column name="lastupdated" valueDate='now()' /> 
			                    <column name="is_active" value='Y' /> 
			                    <column name="is_reportable" value='N' /> 
			                    <column name="test_section_id" valueNumeric=" currval( 'test_section_seq' ) "/>
			                    <column name="local_abbrev" value='DNA PCR' />
			                    <column name="display_key" value="test.dnaPCR"/>
			            </insert>
			            <!-- DNA PCR Test with EDTA Tube -->
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               <column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   <column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   <column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   <column name="is_panel" value="False"/>           
			            </insert>
                        
            <!-- DRY BLOOD SPOT -->
            <insert schemaName="clinlims" tableName="type_of_sample">
                    <column name="id" valueNumeric=" nextval( 'type_of_sample_seq' ) "/>    
                    <column name="lastupdated" valueDate='now()' />
			   		<column name="domain" value='H'/>
			   		<column name="description" value="DBS"/> 
			   		<column name="local_abbrev" value="DBS"/> 
                    <column name="display_key" value="sample.type.DBS"/>         
            </insert> 
            			<!-- DNA PCR Test with DBS -->
			            <insert schemaName="clinlims" tableName="sampletype_test">
			               <column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>    
						   <column name="sample_type_id" valueNumeric=" currval( 'type_of_sample_seq' ) "/>
						   <column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
						   <column name="is_panel" value="False"/>           
			            </insert>   
      
    </changeSet>
 
  	<changeSet author="nixonl" id="9" context="CDIRetroCI">
  				<preConditions onFail="MARK_RAN">
  			 	<sqlCheck expectedResult="0">
  					select count(*) from clinlims.test where local_abbrev = 'Neut %'
  				</sqlCheck> 
    			</preConditions>
               <comment>Add remaining tests and unit of measure</comment>  
               <delete schemaName="clinlims" tableName="unit_of_measure"/>
 
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="g/l"/>
                       <column name="description" value="g/l"/>                 
                       <column name="lastupdated" valueNumeric=" now() "/>
               </insert>
               <update tableName="test">
    				<column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
    				<where>description='Glycémie'</where>
				</update>		
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="mg/l"/>
                       <column name="description" value="mg/l"/>                 
                       <column name="lastupdated" valueNumeric=" now() "/>
               </insert>
               <update tableName="test">
    				<column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
    				<where>description='Créatininémie'</where>
				</update>
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="UI/l"/>
                       <column name="description" value="UI/l"/>                 
                       <column name="lastupdated" valueNumeric=" now() "/>
               </insert>
               
               <update tableName="test">
	    				<column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	    				<column name="description" value="Transaminases ALTL"/>
	    				<column name="local_abbrev" value='Transaminases ALTL' />
				        <column name="display_key" value="test.transminasesALTL"/>
	    				<where>description='Transaminases'</where>
				</update>
				  
				<insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Transaminases ASTL"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Biochemistry' ) "/>
	                    <column name="local_abbrev" value='Transaminases ASTL' />
	                    <column name="display_key" value="test.transminasesASTL"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='Dry Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
			 	<insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="103/µl"/>
                       <column name="description" value="103/µl"/>                 
                       <column name="lastupdated" valueNumeric=" now() "/>
               </insert>
                
				<insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="GB"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='GB' />
	                    <column name="display_key" value="test.GB"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="PLQ"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='PLQ' />
	                    <column name="display_key" value="test.PLQ"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
                
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="%"/>
                       <column name="description" value="%"/>                 
                       <column name="lastupdated" valueDate=" now() "/>
               </insert>
               
               <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Neut %"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='Neut %' />
	                    <column name="display_key" value="test.NeutPercent"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			 
			  <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Lymph %"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='Lymph %' />
	                    <column name="display_key" value="test.LymphPercent"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
			   <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Mono %"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='Mono %' />
	                    <column name="display_key" value="test.MonoPercent"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
			   <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Eo %"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='Eo %' />
	                    <column name="display_key" value="test.EoPercent"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Baso %"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='Baso %' />
	                    <column name="display_key" value="test.BasoPercent"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			    <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="HCT"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='HCT' />
	                    <column name="display_key" value="test.HCT"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			    <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="CCMH"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='CCMH' />
	                    <column name="display_key" value="test.CCMH"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
               
               
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="106/µl"/>
                       <column name="description" value="106/µl"/>                 
                       <column name="lastupdated" valueDate=" now() "/>
               </insert>
                
               <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="GR"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='GR' />
	                    <column name="display_key" value="test.GR"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
               
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="g/dl"/>
                       <column name="description" value="g/dl"/>                 
                       <column name="lastupdated" valueDate=" now() "/>
               </insert>
               
               <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="Hb"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='Hb' />
	                    <column name="display_key" value="test.Hb"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
			   
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="fl"/>
                       <column name="description" value="fl"/>                 
                       <column name="lastupdated" valueDate=" now() "/>
               </insert>
              
               <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="VGM"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='VGM' />
	                    <column name="display_key" value="test.VGM"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			    
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="pg"/>
                       <column name="description" value="pg"/>                 
                       <column name="lastupdated" valueDate=" now() "/>
               </insert>
               
               <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="TCMH"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Hematology' ) "/>
	                    <column name="local_abbrev" value='TCMH' />
	                    <column name="display_key" value="test.TCMH"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   
			   <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="CD3 percentage count"/> 
	                    <column name="uom_id" valueNumeric=" ( select id from clinlims.unit_of_measure where name='%' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Immunology' ) "/>
	                    <column name="local_abbrev" value='CD3 percentage count' />
	                    <column name="display_key" value="test.CD3PercentCount"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
			   <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="CD4 percentage count"/> 
	                    <column name="uom_id" valueNumeric=" ( select id from clinlims.unit_of_measure where name='%' ) "/> 
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Immunology' ) "/>
	                    <column name="local_abbrev" value='CD4 percentage count' />
	                    <column name="display_key" value='test.CD4PercentCount' />
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
				 
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="Cell/µl"/>
                       <column name="description" value="Cell/µl"/>                 
                       <column name="lastupdated" valueDate='now()' />
               </insert>
              
               <insert schemaName="clinlims" tableName="test">
	                    <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
	                    <column name="description" value="CD4 absolute count"/> 
	                    <column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
	                    <column name="lastupdated" valueDate='now()' /> 
	                    <column name="is_active" value='Y' /> 
	                    <column name="is_reportable" value='N' /> 
	                    <column name="test_section_id" valueNumeric=" ( select id from clinlims.test_section where name='Immunology' ) "/>
	                    <column name="local_abbrev" value='CD4 absolute count' />
	                    <column name="display_key" value="test.CD4AbsoluteCount"/>
    			</insert>
			    <insert schemaName="clinlims" tableName="sampletype_test">
		             	<column name="id" valueNumeric="  nextval( 'sample_type_test_seq' ) "/>    
					   	<column name="sample_type_id" valueNumeric=" ( select id from clinlims.type_of_sample where description='EDTA Tube' ) "/>
					   	<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
					   	<column name="is_panel" value="False"/>           
			   </insert>
                
               <insert schemaName="clinlims" tableName="unit_of_measure">
                       <column name="id" valueNumeric=" nextval( 'unit_of_measure_seq' ) "/>
                       <column name="name" value="copies/ ml"/>
                       <column name="description" value="copies/ ml"/>                 
                       <column name="lastupdated" valueDate=" now() "/>
               </insert>
               <update tableName="test">
    				<column name="uom_id" valueNumeric=" currval( 'unit_of_measure_seq' ) "/>
    				<where>description='Viral Load'</where>
				</update>
				
     </changeSet>
     <changeSet author="nixonl" id="10" context="CDIRetroCI">
  				<preConditions onFail="MARK_RAN">
  			 	<sqlCheck expectedResult="0">
  					select count(*) from clinlims.test where description = 'Transaminases ALTL'
  				</sqlCheck> 
    			</preConditions>
               <comment>Adding Transminases ALTL Test</comment>    
                <update schemaName="clinlims" tableName="test">
	    				<column name="uom_id" valueNumeric=" ( select id from clinlims.unit_of_measure where name='UI/l' ) "/>
	    				<column name="description" value="Transaminases ALTL"/>
	    				<column name="local_abbrev" value='Transaminases ALTL' />
				        <column name="display_key" value="test.transminasesALTL"/>
	    				<where>description='Transaminiases'</where>
				</update>   
				
    </changeSet>     
    
	    
    <changeSet author="nixonl" id="11" context="CDIRetroCI">
    	<preConditions onFail="MARK_RAN">
 			 	<sqlCheck expectedResult="0">
 					select count(*) from clinlims.test_reflex tr where tr.test_id = (select t.id from clinlims.test t where t.description='Murex' ) and tr.flags = 'HIV N'
 				</sqlCheck> 
    	</preConditions>
        <comment>Adding HIV Status Final Result Test Reflexes</comment>   
        
    	<!--  If Integral is Negative and Murex is Negative - Set HIV Status Result -->
    	
    	<!--  Murex Test Reflex -->
    	<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative')) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex') "/>
           		<!--  Integral handles sibling id -->
           		<column name="flags" value="HIV N"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
    	<!--  Integral Test Reflex -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative')) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<column name="flags" value="HIV N"/>
           		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id=( select t.id from clinlims.test t where t.local_abbrev='Murex' ) and tr.flags='HIV N' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 	
        <update schemaName="clinlims" tableName="test_reflex">
	    		<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		   		<column name="lastupdated" valueDate='now()' />
	    		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Murex') and flags='HIV N' </where>    	
		</update>				        
    
        <!-- Adding Genie II Final Results Test Reflexes -->   
                
        <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hiv1' ) "/>
           		<column name="result_group" valueNumeric="4"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <insert schemaName="clinlims" tableName="test_result">
        		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
        		<column name="tst_rslt_type" value="D"/> 
        		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIVResult.hiv2' ) "/>
        		<column name="result_group" valueNumeric="4"/>
        		<column name="lastupdated" valueDate='now()' /> 
        </insert>
    	<!--  If Genie II is HIV 1 - Set HIV Status Result -->
    	<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hiv1')) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II Result' and t.id = ta.test_id and t.description = 'Genie II') "/>
           		<!--  No sibling-->
           		<column name="flags" value="HIV 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		
		<!--  If Genie II is HIV 2 - Set HIV Status Result -->
    	<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hiv2')) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II Result' and t.id = ta.test_id and t.description = 'Genie II') "/>
           		<!--  No sibling-->
           		<column name="flags" value="HIV 2"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		
		<!--  If Genie II is Negative - Add Sibling Reflexes to WB1 and WB2 -->
		<!--  WB1 -->
		<update schemaName="clinlims" tableName="test_reflex">
	    		<column name="sibling_reflex" valueNumeric=" ( select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II' ) and tr.add_test_id= ( select tt.id from clinlims.test tt where tt.local_abbrev='Western Blot 2' )) "/>
		   		<column name="lastupdated" valueDate='now()' />
	    		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II') and add_test_id= ( select id from clinlims.test where local_abbrev='Western Blot 1' )  </where>    	
		</update>
		
		<!--  WB2 -->
		<update schemaName="clinlims" tableName="test_reflex">
	    		<column name="sibling_reflex" valueNumeric=" ( select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II' ) and tr.add_test_id= ( select tt.id from clinlims.test tt where tt.local_abbrev='Western Blot 1' )) "/> 	
		   		<column name="lastupdated" valueDate='now()' />
	    		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II') and add_test_id= ( select id from clinlims.test where local_abbrev='Western Blot 2' )  </where>    	   	
		</update>
			        
        <!-- Adding Western Blot Final Results Test Reflexes  --> 
                       
    	<!--  If WB1 is Positive and WB2 is Positive - Set HIV Status Result -->
	    	<!--  WB1 -->
	    	<insert schemaName="clinlims" tableName="test_reflex">
	           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
	           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
	           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
	           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1' ) "/>
	           		<!-- Add sibling later -->
	           		<column name="flags" value="HIV D"/>
	           		<column name="lastupdated" valueDate='now()' /> 
			</insert> 
			
			<!--  WB2 -->
	    	<insert schemaName="clinlims" tableName="test_reflex">
	           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
	           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
	           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
	           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
	           		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1' ) and tr.flags='HIV D' ) "/>
	           		<column name="flags" value="HIV D"/>
	           		<column name="lastupdated" valueDate='now()' /> 
			</insert> 
			<update schemaName="clinlims" tableName="test_reflex">
		    		<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			   		<column name="lastupdated" valueDate='now()' />
		    		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and flags='HIV D' </where>    	
			</update>
		
		<!--  If WB1 is Positive and WB2 is Negative - Set HIV Status Result -->
	    	<!--  WB1 -->
	    	<insert schemaName="clinlims" tableName="test_reflex">
	           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
	           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
	           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
	           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
	           		<!-- Add sibling later -->
	           		<column name="flags" value="HIV 1"/>
	           		<column name="lastupdated" valueDate='now()' /> 
			</insert> 
			
			<!--  WB2 -->
	    	<insert schemaName="clinlims" tableName="test_reflex">
	           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
	           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
	           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
	           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
	           		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1' ) and tr.flags='HIV 1' ) "/>
	           		<column name="flags" value="HIV 1"/>
	           		<column name="lastupdated" valueDate='now()' /> 
			</insert> 
			<update schemaName="clinlims" tableName="test_reflex">
		    		<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			   		<column name="lastupdated" valueDate='now()' />
		    		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and flags='HIV 1' </where>    	
			</update>
			
		<!--  If WB1 is Negative and WB2 is Positive - Set HIV Status Result -->
	    	<!--  WB1 -->
	    	<insert schemaName="clinlims" tableName="test_reflex">
	           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
	           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
	           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
	           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
	           		<!-- Add sibling later -->
	           		<column name="flags" value="HIV 2"/>
	           		<column name="lastupdated" valueDate='now()' /> 
			</insert> 
			
			<!--  WB2 -->
	    	<insert schemaName="clinlims" tableName="test_reflex">
	           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
	           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
	           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
	           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
	           		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1' ) and tr.flags='HIV 2' ) "/>
	           		<column name="flags" value="HIV 2"/>
	           		<column name="lastupdated" valueDate='now()' /> 
			</insert> 
			<update schemaName="clinlims" tableName="test_reflex">
		    		<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			   		<column name="lastupdated" valueDate='now()' />
		    		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and flags='HIV 2' </where>    	
			</update>
			
			<!-- Delete any WB1 or WB2 reflex tests for Ind or Neg results -->
			<delete schemaName="clinlims" tableName="test_reflex">
            	<where>test_id = ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and add_test_id=( select t.id from clinlims.test t where t.local_abbrev='p24 Ag') </where>
    		</delete>
    		<delete schemaName="clinlims" tableName="test_reflex">
            	<where>test_id = ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 2') and add_test_id=( select t.id from clinlims.test t where t.local_abbrev='p24 Ag') </where>
    		</delete>
			
			
			<!--  If WB1 is Negative and WB2 is Negative - P24 Ag Test -->
		    	<!--  WB1 -->
		    	<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select tr.id from clinlims.test_result tr where tr.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( tr.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<!-- Add sibling later -->
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert> 
			
				<!--  WB2 -->
				<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<column name="sibling_reflex" valueNumeric=" ( select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1' ) and tr.add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' ) and tr.tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' ) ) ) "/>
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert>    
		        <update schemaName="clinlims" tableName="test_reflex">
			    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			    	<column name="lastupdated" valueDate='now()' />
			    	<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' ) and tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric ) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' ) ) </where>    	
	  			</update>
	  			
	  		<!--  If WB1 is Indeterminate and WB2 is Indeterminate - P24 Ag Test -->
		    	<!--  WB1 -->
		    	<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select tr.id from clinlims.test_result tr where tr.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( tr.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<!-- Add sibling later -->
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert> 
			
				<!--  WB2 -->
				<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<column name="sibling_reflex" valueNumeric=" ( select tr.id from clinlims.test_reflex tr where tr.test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1' ) and tr.add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' ) and tr.tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' ) ) ) "/>
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert>    
		        <update schemaName="clinlims" tableName="test_reflex">
			    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			    	<column name="lastupdated" valueDate='now()' />
			    	<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' ) and tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric ) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' ) ) </where>    	
	  			</update>
	  						
	  		<!--  If WB1 is Indeterminate and WB2 is Positive - P24 Ag Test -->
		    	<!--  WB1 -->
		    	<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select tr.id from clinlims.test_result tr where tr.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( tr.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<!-- Add sibling later -->
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert> 
			
				<!--  WB2 -->
				<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		 <column name="sibling_reflex" valueNumeric=" ( currval( ' test_reflex_seq' ) - 1 ) "/>
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert>  
				   
		        <update schemaName="clinlims" tableName="test_reflex">
			    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			    	<column name="lastupdated" valueDate='now()' />
			    	<where>id = ( select tr.sibling_reflex from test_reflex tr where tr.id= currval ( 'test_reflex_seq' ) ) and test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' ) and tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric ) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' ) )  </where>    	
	  			</update>
	  			
	  		<!--  If WB1 is Negative and WB2 is Indeterminate - P24 Ag Test -->
		    	<!--  WB1 -->
		    	<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select tr.id from clinlims.test_result tr where tr.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( tr.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<!-- Add sibling later -->
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert> 
			
				<!--  WB2 -->
				<insert schemaName="clinlims" tableName="test_reflex">
		           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
		           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
		           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
		           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2' ) "/>
		           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='p24 Ag' ) "/>
		           		<column name="sibling_reflex" valueNumeric=" ( currval( ' test_reflex_seq' ) - 1 ) "/>
		           		<column name="lastupdated" valueDate='now()' /> 
				</insert>  
				   
		        <update schemaName="clinlims" tableName="test_reflex">
			    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
			    	<column name="lastupdated" valueDate='now()' />
			    	<where>id = ( select tr.sibling_reflex from test_reflex tr where tr.id= currval ( 'test_reflex_seq' ) ) and test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' ) and tst_rslt_id= ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric ) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' ) )  </where>    	
	  			</update>
	
		
        <!--   Adding Genie II 100 and Genie II 10 Final Results Test Reflexes -->  
      	<!-- Genie II 100 -->
 	   <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hiv1' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100') "/>
           		<column name="flags" value="HIV 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hiv2' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100') "/>
           		<column name="flags" value="HIV 2"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hivd' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100') "/>
           		<column name="flags" value="HIV D"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
	
		<!-- Genie II 10 -->
	  	<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hiv1' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10') "/>
           		<column name="flags" value="HIV 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hiv2' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10') "/>
           		<column name="flags" value="HIV 2"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.hivd' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10') "/>
           		<column name="flags" value="HIV D"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10') "/>
           		<column name="flags" value="HIV N"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        
    </changeSet>
    
    <changeSet author="nixonl" id="15" context="CDIRetroCI">
    	<preConditions onFail="MARK_RAN">
 			 	<sqlCheck expectedResult="0">
 					select count(*) from clinlims.test_reflex tr where tr.test_id = (select t.id from clinlims.test t where t.description='GB' ) and tr.flags = 'CalcCD4'
 				</sqlCheck> 
    	</preConditions>
        <comment>Adding CD4 Absolute Count Calculation Test Reflexes</comment>
        
        <insert schemaName="clinlims" tableName="dictionary_category">
                <column name="id" valueNumeric=" nextval( 'dictionary_category_seq' ) "/>  
                <column name="name" value="Result Type"/>
                <column name="description" value="Result Type - Numeric, etc"/>
                <column name="local_abbrev" value="ResultType"/>         
                <column name="lastupdated" valueDate='now()' />   
       	</insert>
  		<insert schemaName="clinlims" tableName="dictionary">
                <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
                <column name="is_active" value="Y"/>      
                <column name="dict_entry" value="Numeric"/>
                <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
                <column name="lastupdated" valueDate='now()' /> 
                <column name="display_key" value="dict.resultType.numeric"/>
        </insert>
        
        <!-- CD4 percentage count Test Reflex -->
        <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='CD4 percentage count' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.resultType.numeric' ) "/>
           		<column name="result_group" valueNumeric="11"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="analyte">
            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
            	<column name="name" value="CD4 percentage count Result"/>   
            	<column name="is_active" value='Y' /> 
            	<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_analyte">
           		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='CD4 percentage count' ) "/>
           		<column name="analyte_id" valueNumeric=" ( select id from clinlims.analyte where name='CD4 percentage count Result' ) "/>
           		<column name="result_group" valueNumeric="11"/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<column name="sort_order" valueNumeric="1"/>
		</insert>
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='CD4 percentage count' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
           		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
           		<!-- Add sibling later -->
           		<column name="flags" value="Calc CD4"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		
		<!-- GB Test Reflex -->
        <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='GB' ) "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.resultType.numeric' ) "/>
           		<column name="result_group" valueNumeric="12"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="analyte">
            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
            	<column name="name" value="GB Result"/>   
            	<column name="is_active" value='Y' /> 
            	<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_analyte">
           		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='GB' ) "/>
           		<column name="analyte_id" valueNumeric=" ( select id from clinlims.analyte where name='GB Result' ) "/>
           		<column name="result_group" valueNumeric="12"/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<column name="sort_order" valueNumeric="1"/>
		</insert>
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='GB' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
           		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
           		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id=( select t.id from clinlims.test t where t.local_abbrev='CD4 percentage count' ) and tr.flags='Calc CD4' ) "/>
           		<column name="flags" value="Calc CD4"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		
        
        <!-- Lymph % Test Reflex -->
        <insert schemaName="clinlims" tableName="test_result">
		            		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
		            		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Lymph %' ) "/>
		            		<column name="tst_rslt_type" value="D"/> 
		            		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.resultType.numeric' ) "/>
		            		<column name="result_group" valueNumeric="13"/>
		            		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="analyte">
			            	<column name="id" valueNumeric=" nextval( 'analyte_seq' ) "/> 
			            	<column name="name" value="Lymph % Result"/>   
			            	<column name="is_active" value='Y' /> 
			            	<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_analyte">
		             		<column name="id" valueNumeric=" nextval( 'test_analyte_seq' ) "/>  
		             		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Lymph %' ) "/>
		             		<column name="analyte_id" valueNumeric=" ( select id from clinlims.analyte where name='Lymph % Result' ) "/>
		             		<column name="result_group" valueNumeric="13"/>
		             		<column name="lastupdated" valueDate='now()' /> 
		             		<column name="sort_order" valueNumeric="1"/>
		</insert>
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Lymph %' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" currval( 'test_result_seq' ) "/>
           		<column name="test_analyte_id" valueNumeric=" currval( 'test_analyte_seq' ) "/>
           		<column name="sibling_reflex" valueNumeric=" (  select tr.id from clinlims.test_reflex tr where tr.test_id=( select t.id from clinlims.test t where t.local_abbrev='GB' ) and tr.flags='Calc CD4' ) "/>
           		<column name="flags" value="Calc CD4"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='CD4 percentage count') and flags='Calc CD4' </where>
	  	</update>
    </changeSet>
     
    <changeSet author="nixonl" id="16" context="CDIRetroCI">
    	<preConditions onFail="MARK_RAN">
 			 	<sqlCheck expectedResult="0">
 					select count(*) from clinlims.scriptlet where name='HIV Status Indeterminate'
 				</sqlCheck> 
    	</preConditions>
        <comment>Changing test reflexes to use scriptlet FK instead of flags </comment> 
        <delete tableName = "label" schemaName="clinlims" />
    	<delete tableName = "scriptlet" schemaName="clinlims" />
    	<insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status Indeterminate"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV Indeterminate"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status Negative"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV N"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Murex') and flags='HIV N' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Integral') and flags='HIV N' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 10') and flags='HIV N' </where>
		</update>
		<insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status HIV 1"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II') and flags='HIV 1' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 100') and flags='HIV 1' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 10') and flags='HIV 1' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and flags='HIV 1' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 2') and flags='HIV 1' </where>
		</update>
		<insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status HIV 2"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV 2"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II') and flags='HIV 2' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 100') and flags='HIV 2' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 10') and flags='HIV 2' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and flags='HIV 2' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 2') and flags='HIV 2' </where>
		</update>
		<insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status HIV D"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV D"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 100') and flags='HIV D' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Genie II 10') and flags='HIV D' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1') and flags='HIV D' </where>
		</update>
		<update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value=""/>
           		<column name="scriptlet_id" valueNumeric=" currval( 'scriptlet_seq' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
           		<where>test_id= ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 2') and flags='HIV D' </where>
		</update>
		
		<!--  Vironostika Final Result Negative -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Vironostika' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Vironostika' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Vironostika Result' and t.id = ta.test_id and t.description = 'Vironostika') "/>   		
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Negative' ) "/>     		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		
		<!--  WB1 Positive & WB2 Indeterminate -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 1' ) "/>
           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 1' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!--  WB1 Indeterminate & WB2 Positive -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 2' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 2' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
		<!--  User Choice  -->
		<!-- Add UC flag to p24Ag test reflexes -->
		<delete schemaName="clinlims" tableName="test_reflex">
			<where> add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' )  </where>
		</delete>
		<!-- <update schemaName="clinlims" tableName="test_reflex">          		
           		<column name="flags" value="UC" />	
           		<column name="lastupdated" valueDate='now()' /> 
           		<where> add_test_id= ( select te.id from clinlims.test te where te.local_abbrev='p24 Ag' )  </where>
		</update> -->
		<!-- WB1 Negative & WB2 Negative - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Negative' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Negative' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!-- WB1 Indeterminate & WB2 Indeterminate - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!-- WB1 Indeterminate & WB2 Negative - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  		<!-- WB1 Negative & WB2 Indeterminate - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	
	  	<!-- Remove sibling for WB1 & WB2 from Genie II -->
		<update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric="null"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>test_id= ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and add_test_id = ( select t.id from clinlims.test t where t.local_abbrev='Western Blot 1' ) </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric="null"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>test_id= ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and add_test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) </where>
	  	</update>
	  	
	  	<!-- Calc CD4  -->
        <insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="Calculate CD4"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="Calc CD4"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<update schemaName="clinlims" tableName="test_reflex">	
				<column name="flags" value=""/>
		    	<column name="lastupdated" valueDate='now()' />
		    	<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='Calculate CD4' ) "/>
		    	<where>test_id= ( select a.id from clinlims.test a where a.local_abbrev='Lymph %' ) 
		    	and flags= 'Calc CD4' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test_reflex">	
				<column name="flags" value=""/>
		    	<column name="lastupdated" valueDate='now()' />
		    	<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='Calculate CD4' ) "/>
		    	<where>test_id= ( select a.id from clinlims.test a where a.local_abbrev='GB' ) 
		    	and flags= 'Calc CD4' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test_reflex">	
				<column name="flags" value=""/>
		    	<column name="lastupdated" valueDate='now()' />
		    	<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='Calculate CD4' ) "/>
		    	<where>test_id= ( select a.id from clinlims.test a where a.local_abbrev='CD4 percentage count' ) 
		    	and flags= 'Calc CD4' </where>
	  	</update>

  		<!--  p24 Ag Reflex Tests -->
        <insert schemaName="clinlims" tableName="dictionary_category">
             <column name="id" valueNumeric=" nextval( 'dictionary_category_seq' ) "/>  
             <column name="name" value="HIV1NInd"/>
             <column name="description" value="Result Values - HIV 1, Negative, Indeterminate"/>
             <column name="local_abbrev" value="HIV1NInd"/>         
             <column name="lastupdated" valueDate='now()' />   
       	</insert>
  		<insert schemaName="clinlims" tableName="dictionary">
              <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
              <column name="is_active" value="Y"/>      
              <column name="dict_entry" value="HIV 1"/>
              <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
              <column name="lastupdated" valueDate='now()' /> 
              <column name="display_key" value="dict.HIV1NInd.hiv1"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
              <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
              <column name="is_active" value="Y"/>      
              <column name="dict_entry" value="Negative"/>
              <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
              <column name="lastupdated" valueDate='now()' /> 
              <column name="display_key" value="dict.HIV1NInd.negative"/>
        </insert>
        <insert schemaName="clinlims" tableName="dictionary">
              <column name="id" valueNumeric=" nextval( 'dictionary_seq' ) "/>
              <column name="is_active" value="Y"/>      
              <column name="dict_entry" value="Indeterminate"/>
              <column name="dictionary_category_id" valueNumeric=" currval( 'dictionary_category_seq' ) "/>
              <column name="lastupdated" valueDate='now()' /> 
              <column name="display_key" value="dict.HIV1NInd.indeterminate"/>
        </insert>
        <delete schemaName="clinlims" tableName="test_result">
        	<where>test_id= ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) </where>
        </delete>
        <insert schemaName="clinlims" tableName="test_result">
          		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
          		<column name="test_id" valueNumeric=" ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) "/>
          		<column name="tst_rslt_type" value="D"/> 
          		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIV1NInd.hiv1' ) "/>
          		<column name="result_group" valueNumeric="14"/>
          		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_result">
          		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
          		<column name="test_id" valueNumeric=" ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) "/>
          		<column name="tst_rslt_type" value="D"/> 
          		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIV1NInd.negative' ) "/>
          		<column name="result_group" valueNumeric="14"/>
          		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_result">
          		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
          		<column name="test_id" valueNumeric=" ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) "/>
          		<column name="tst_rslt_type" value="D"/> 
          		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.HIV1NInd.indeterminate' ) "/>
          		<column name="result_group" valueNumeric="14"/>
          		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<!-- HIV 1 Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIV1NInd.hiv1' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'p24 Ag Result' and t.id = ta.test_id and t.description = 'p24 Ag') "/>
        		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 1' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		
		<!-- User Choice -->
		<!--  Negative -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIV1NInd.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'p24 Ag Result' and t.id = ta.test_id and t.description = 'p24 Ag') "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Negative' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<!--  Indeterminate -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='p24 Ag' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIV1NInd.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'p24 Ag Result' and t.id = ta.test_id and t.description = 'p24 Ag') "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Indeterminate' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>   
		 
		<!--  Change Calc CD4 test results -->
		<update schemaName="clinlims" tableName="test_result">
           		<column name="tst_rslt_type" value="N"/> 
           		<column name="value" value=""/>
           		<column name="result_group" valueNumeric="15"/>
           		<column name="lastupdated" valueDate='now()' /> 
         	<where>test_id= ( select id from clinlims.test where description='Lymph %' ) </where>
		</update>
		<update schemaName="clinlims" tableName="test_result">
           		<column name="tst_rslt_type" value="N"/> 
           		<column name="value" value=""/>
           		<column name="result_group" valueNumeric="16"/>
           		<column name="lastupdated" valueDate='now()' /> 
           <where>test_id= ( select id from clinlims.test where description='GB' ) </where>
		</update>
		<update schemaName="clinlims" tableName="test_result">
           		<column name="tst_rslt_type" value="N"/> 
           		<column name="value" value=""/>
           		<column name="result_group" valueNumeric="17"/>
           		<column name="lastupdated" valueDate='now()' /> 
           <where>test_id= ( select id from clinlims.test where description='CD4 percentage count' ) </where>
		</update>
		
		<delete schemaName="clinlims" tableName="dictionary">
			<where>display_key='dict.resultType.numeric' </where>
		</delete>
		
		<delete schemaName="clinlims" tableName="dictionary_category">
			<where>local_abbrev='ResultType' </where>
		</delete>
		
  </changeSet>
  <changeSet author="paulsc" id="1" context="CDIRetroCI">
  <comment>Drops some tests and adds others.  Note: It may be nessessary to run the context deleteData to be able to drop "CD4"</comment>
       <delete schemaName="clinlims" tableName="sampletype_test">
               <where>test_id in (select t.id from clinlims.test t where description ='NFS' or name='CD4') </where>
       </delete>
       <delete schemaName="clinlims" tableName="test">
               <where>description ='NFS' or name='CD4'</where>
       </delete>
       <insert schemaName="clinlims" tableName="test_result">
                <column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>
                <column name="test_id" valueNumeric=" (select t.id from clinlims.test t where t.description='Cell Sequencing') "/>
                <column name="result_group" valueNumeric=" ( select max(tr.result_group) + 1 from clinlims.test_result tr ) "/>
                <column name="tst_rslt_type" value="R"/>
                <column name="lastupdated" valueDate=" now() "/>
        </insert>
       <update schemaName="clinlims" tableName="test">
               <column name="description" value="Génotypage"/>
               <column name="local_abbrev" value="Génotypage"/>
               <where>description='Cell Sequencing'</where>
        </update>
        <insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="NO#"/>
                <column name="lastupdated" valueDate='now()' />
                <column name="is_active" value='Y' />
                <column name="is_reportable" value='N' />
                <column name="test_section_id" valueNumeric=" ( select ts.id from clinlims.test_section ts where ts.name='Hematology' ) "/>
                <column name="local_abbrev" value='NO#' />
                <column name="display_key" value="test.no.count"/>
        </insert>
        <insert schemaName="clinlims" tableName="sampletype_test">
	               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
				   		<column name="sample_type_id" valueNumeric=" ( select tos.id from clinlims.type_of_sample tos where tos.description='EDTA Tube' ) "/>
				   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
				   		<column name="is_panel" value="False"/>
        </insert>
        <insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="MO#"/>
                <column name="lastupdated" valueDate='now()' />
                <column name="is_active" value='Y' />
                <column name="is_reportable" value='N' />
                <column name="test_section_id" valueNumeric=" ( select ts.id from clinlims.test_section ts where ts.name='Hematology' ) "/>
                <column name="local_abbrev" value='MO#' />
                <column name="display_key" value="test.monocyte.count"/>
        </insert>
        <insert schemaName="clinlims" tableName="sampletype_test">
	               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
				   		<column name="sample_type_id" valueNumeric=" ( select tos.id from clinlims.type_of_sample tos where tos.description='EDTA Tube' ) "/>
				   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
				   		<column name="is_panel" value="False"/>
        </insert>
        <insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="BA#"/>
                <column name="lastupdated" valueDate='now()' />
                <column name="is_active" value='Y' />
                <column name="is_reportable" value='N' />
                <column name="test_section_id" valueNumeric=" ( select ts.id from clinlims.test_section ts where ts.name='Hematology' ) "/>
                <column name="local_abbrev" value='BA#' />
                <column name="display_key" value="test.Basophil.count"/>
        </insert>
        <insert schemaName="clinlims" tableName="sampletype_test">
	               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
				   		<column name="sample_type_id" valueNumeric=" ( select tos.id from clinlims.type_of_sample tos where tos.description='EDTA Tube' ) "/>
				   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
				   		<column name="is_panel" value="False"/>
        </insert>
        <insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="LY#"/>
                <column name="lastupdated" valueDate='now()' />
                <column name="is_active" value='Y' />
                <column name="is_reportable" value='N' />
                <column name="test_section_id" valueNumeric=" ( select ts.id from clinlims.test_section ts where ts.name='Hematology' ) "/>
                <column name="local_abbrev" value='LY#' />
                <column name="display_key" value="test.lymphocyte.count"/>
        </insert>
        <insert schemaName="clinlims" tableName="sampletype_test">
	               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
				   		<column name="sample_type_id" valueNumeric=" ( select tos.id from clinlims.type_of_sample tos where tos.description='EDTA Tube' ) "/>
				   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
				   		<column name="is_panel" value="False"/>
        </insert>
        <insert schemaName="clinlims" tableName="test">
                <column name="id" valueNumeric=" nextval( 'test_seq' ) "/>
                <column name="description" value="EO#"/>
                <column name="lastupdated" valueDate='now()' />
                <column name="is_active" value='Y' />
                <column name="is_reportable" value='N' />
                <column name="test_section_id" valueNumeric=" ( select ts.id from clinlims.test_section ts where ts.name='Hematology' ) "/>
                <column name="local_abbrev" value='EO#' />
                <column name="display_key" value="test.eosinophil.count"/>
        </insert>
        <insert schemaName="clinlims" tableName="sampletype_test">
	               		<column name="id" valueNumeric=" nextval( 'sample_type_test_seq' ) "/>
				   		<column name="sample_type_id" valueNumeric=" ( select tos.id from clinlims.type_of_sample tos where tos.description='EDTA Tube' ) "/>
				   		<column name="test_id" valueNumeric=" currval( 'test_seq' ) "/>
				   		<column name="is_panel" value="False"/>
        </insert>
</changeSet>


<changeSet author="nixonl" id="17" context="CDIRetroCI">
        <comment>Adding remaining test reflexes for Indeterminate and Invalid results </comment> 
        <!-- Murex Positive, Integral Indeterminate  -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Negative, Integral Indeterminate  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Positive, Integral Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Negative, Integral Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Indeterminate, Integral Positive  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Invalid, Integral Positive  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Indetermiante, Integral Negative  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Invalid, Integral Positive  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Indeterminate, Integral Indeterminate  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Murex Invalid, Integral Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
 		<!-- Vironostika Indeterminate  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Vironostika' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Vironostika' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Vironostika Result' and t.id = ta.test_id and t.description = 'Vironostika')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Vironostika' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Vironostika' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Vironostika Result' and t.id = ta.test_id and t.description = 'Vironostika')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
        <!-- Vironostika Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Vironostika' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Vironostika' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Vironostika Result' and t.id = ta.test_id and t.description = 'Vironostika')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Vironostika' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Vironostika' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Vironostika Result' and t.id = ta.test_id and t.description = 'Vironostika')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
         <!-- Genie II Indeterminate  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II Result' and t.id = ta.test_id and t.description = 'Genie II')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II Result' and t.id = ta.test_id and t.description = 'Genie II')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
          <!-- Genie II Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II Result' and t.id = ta.test_id and t.description = 'Genie II')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II Result' and t.id = ta.test_id and t.description = 'Genie II')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
         <!-- Genie II 1/100 Indeterminate  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
          <!-- Genie II 1/100 Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 100' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 100' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 100 Result' and t.id = ta.test_id and t.description = 'Genie II 100')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
          <!-- Genie II 1/10 Indeterminate  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
           <!-- Genie II 1/10 Invalid  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert> 
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Genie II 10' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Genie II 10' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.HIVResult.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Genie II 10 Result' and t.id = ta.test_id and t.description = 'Genie II 10')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
		
</changeSet>


<changeSet author="nixonl" id="18" context="CDIRetroCI">
	  <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' )  "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.indeterminate' ) "/>
           		<column name="result_group" valueNumeric="18"/>
           		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' )  "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.invalid' ) "/>
           		<column name="result_group" valueNumeric="18"/>
           		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' )  "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.positive' ) "/>
           		<column name="result_group" valueNumeric="18"/>
           		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_result">
           		<column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>   
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' )  "/>
           		<column name="tst_rslt_type" value="D"/> 
           		<column name="value" valueNumeric=" ( select id from clinlims.dictionary where display_key='dict.PosNegIndInv.negative' ) "/>
           		<column name="result_group" valueNumeric="18"/>
           		<column name="lastupdated" valueDate='now()' /> 
      </insert>
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='DNA PCR' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'DNA PCR Result' and t.id = ta.test_id and t.description = 'DNA PCR')  "/>	
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Indeterminate' ) "/> 
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='DNA PCR' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'DNA PCR Result' and t.id = ta.test_id and t.description = 'DNA PCR')  "/>	
           			<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Indeterminate' ) "/> 
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
        <insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status Positive"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV Positive"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='DNA PCR' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'DNA PCR Result' and t.id = ta.test_id and t.description = 'DNA PCR')  "/>	
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Positive' ) "/> 
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
        <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='DNA PCR' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='DNA PCR' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'DNA PCR Result' and t.id = ta.test_id and t.description = 'DNA PCR')  "/>	
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV N' ) "/> 
           		<!-- No sibling  -->
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>
  
   </changeSet>
		

<changeSet author="nixonl" id="19" context="CDIRetroCI">
 	<comment>Adding WB invalid test reflexes </comment> 
 	  <insert schemaName="clinlims" tableName="scriptlet">
           		<column name="id" valueNumeric=" nextval( 'scriptlet_seq' ) "/>  
           		<column name="name" value="HIV Status Indeterminate"/>
           		<column name="code_type" value="I"/>
           		<column name="code_source" value="HIV Indeterminate"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
	<!--  WB1 Positive & WB2 Invalid -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 1' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 1' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!--  WB1 invalid & WB2 Positive -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 2' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.positive' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status HIV 2' ) "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
		<!--  User Choice  -->
		<!-- WB1 Invalid & WB2 Indeterminate - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!-- WB1 Indeterminate & WB2 Invalid - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.indeterminate' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!-- WB1 invalid & WB2 invalid - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Invalid' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Invalid' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	<!-- WB1 invalid & WB2 Negative - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Invalid' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Invalid' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  		<!-- WB1 Negative & WB2 invalid - p24 Ag or Final Result -->
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 1' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 1' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 1 Result' and t.id = ta.test_id and t.description = 'Western Blot 1') "/>
           		<!-- Add sibling later -->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Invalid' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Western Blot 2' ) "/>
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where description='p24 Ag' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Western Blot 2' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Western Blot 2 Result' and t.id = ta.test_id and t.description = 'Western Blot 2') "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1 "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name='HIV Status Invalid' ) "/>
           		<column name="flags" value="UC"/>
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
        <update schemaName="clinlims" tableName="test_reflex">
		    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>id= currval( 'test_reflex_seq' ) - 1 </where>
	  	</update>
	  	
	  </changeSet>
	  <changeSet author="nixonl" id="20" context="CDIRetroCI">
	  <comment>Adding Murex Invalid, Integral Negative</comment>
	  
	  <!-- Murex Invalid, Integral Negative  -->
 		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Integral' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Integral' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.negative' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Integral Result' and t.id = ta.test_id and t.description = 'Integral') "/>
           		<!-- Add sibling later -->
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>	           		
           		<column name="lastupdated" valueDate='now()' /> 
		</insert> 
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where description='Murex' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select r.id from clinlims.test_result r where r.test_id = ( select a.id from clinlims.test a where a.local_abbrev='Murex' ) and cast ( r.value as numeric) = ( select d.id from clinlims.dictionary d where d.display_key='dict.PosNegIndInv.invalid' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select ta.id from clinlims.test_analyte ta, clinlims.analyte a, clinlims.test t where a.id = ta.analyte_id and a.name = 'Murex Result' and t.id = ta.test_id and t.description = 'Murex')  "/>	
           		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Vironostika' ) "/>
           		<column name="sibling_reflex" valueNumeric=" currval( 'test_reflex_seq' ) - 1"/>
           		<column name="lastupdated" valueDate='now()' /> 
        </insert>  
        <update schemaName="clinlims" tableName="test_reflex">
	    	<column name="sibling_reflex" valueNumeric=" currval ( 'test_reflex_seq' ) "/> 	
	    	<column name="lastupdated" valueDate='now()' />
	    	<where>id =  ( currval ( 'test_reflex_seq' ) - 1 ) </where>
 		</update>
	  </changeSet>
      <changeSet author="paulsc" id="2" context="CDIRetroCI"  >
                 <comment>Make the result type of Viral Load to be A (for alphanumeric)</comment>
                 <insert schemaName="clinlims" tableName="test_result">
                         <column name="id" valueNumeric=" nextval( 'test_result_seq' ) "/>
                         <column name="test_id" valueNumeric=" (select t.id from clinlims.test t where t.description='Viral Load') "/>
                         <column name="result_group" valueNumeric=" ( select max(tr.result_group) + 1 from clinlims.test_result tr ) "/>
                         <column name="tst_rslt_type" value="A"/>
                <column name="lastupdated" valueDate=" now() "/>
        </insert>
      </changeSet>
	  <changeSet author="nixonl" id="21" context="CDIRetroCI">
	  <comment>Setting sort order for Tests by section</comment>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="1"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Murex' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="2"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Integral' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="3"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Vironostika' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="4"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Genie II' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="5"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Genie II 100' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="6"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Genie II 10' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="7"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Western Blot 1' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="8"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Western Blot 2' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="9"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'p24 Ag' </where>
	  	</update>
	  	
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="10"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'GB' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="11"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Neut %' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="12"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Lymph %' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="13"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Mono %' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="14"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Eo %' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="15"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Baso %' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="16"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'GR' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="17"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Hb' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="18"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'HCT' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="19"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'VGM' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="20"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'TCMH' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="21"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'CCMH' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="22"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'PLQ' </where>
	  	</update>
	  	
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="23"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Transaminases ALTL' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="24"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Transaminases ASTL' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="25"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Créatininémie' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="26"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Glycémie' </where>
	  	</update>
	  
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="27"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'CD3 percentage count' </where>
	  	</update>
	  		  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="28"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'CD4 percentage count' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="29"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'CD4 absolute count' </where>
	  	</update>
	  
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="30"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'DNA PCR' </where>
	  	</update>
	  		  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="31"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Génotypage' </where>
	  	</update>
	  	<update schemaName="clinlims" tableName="test">
		    	<column name="sort_order" valueNumeric="32"/> 	
		    	<column name="lastupdated" valueDate='now()' />
		    	<where>local_abbrev= 'Viral Load' </where>
	  	</update>
	  
	  </changeSet>
	  <changeSet author="paulsc" id="3" context="CDIRetroCI">
	  	<comment>Adds the bioline reflexes</comment>
	    <insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'HIV1' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name = 'HIV Status HIV 1' ) " />
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'HIV2' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
           		<!--  No sibling-->
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name = 'HIV Status HIV 2' ) " />
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
		<insert schemaName="clinlims" tableName="test_reflex">
           		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
           		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
           		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'HIVD' )) "/>
           		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
           		<column name="scriptlet_id" valueNumeric=" ( select id from clinlims.scriptlet where name = 'HIV Status HIV D' ) " />
           		<column name="lastupdated" valueDate='now()' /> 
		</insert>
			            
	
       <insert schemaName="clinlims" tableName="test_reflex">
        		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
        		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'Negative' )) "/>
        		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
        		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
        		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_reflex">
        		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
        		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'Indeterminate' )) "/>
        		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
        		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
        		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_reflex">
        		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
        		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'Invalid')) "/>
        		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
        		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 1' ) "/>
        		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_reflex">
        		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
        		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'Negative' )) "/>
        		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
        		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
        		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_reflex">
        		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
        		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'Indeterminate' )) "/>
        		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
        		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
        		<column name="lastupdated" valueDate='now()' /> 
      </insert>
      <insert schemaName="clinlims" tableName="test_reflex">
        		<column name="id" valueNumeric=" nextval( 'test_reflex_seq' ) "/>  
        		<column name="test_id" valueNumeric=" ( select id from clinlims.test where name = 'Bioline' ) "/>
        		<column name="tst_rslt_id" valueNumeric=" ( select id from clinlims.test_result  where test_id = ( select id from clinlims.test  where name ='Bioline' ) and cast ( value as numeric) in ( select id from clinlims.dictionary where dict_entry = 'Invalid')) "/>
        		<column name="test_analyte_id" valueNumeric=" ( select id from clinlims.test_analyte where analyte_id = ( select id from clinlims.analyte where name = 'Bioline Results' )) "/>
        		<column name="add_test_id" valueNumeric=" ( select id from clinlims.test where local_abbrev='Western Blot 2' ) "/>
        		<column name="lastupdated" valueDate='now()' /> 
      </insert>
   </changeSet>
</databaseChangeLog>


